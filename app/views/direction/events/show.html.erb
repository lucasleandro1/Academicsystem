<% content_for :title, @event.title %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1><i class="fas fa-calendar-alt"></i> <%= @event.title %></h1>
    <p class="text-muted mb-0">
      Evento da escola <%= current_user.school.name %>
    </p>
  </div>
  <div class="btn-group">
    <%= link_to direction_events_path, class: "btn btn-outline-secondary" do %>
      <i class="fas fa-arrow-left"></i> Voltar
    <% end %>
    <%= link_to edit_direction_event_path(@event), class: "btn btn-warning" do %>
      <i class="fas fa-edit"></i> Editar
    <% end %>
    <%= link_to direction_event_path(@event), method: :delete, 
                confirm: "Tem certeza que deseja excluir este evento?",
                class: "btn btn-danger" do %>
      <i class="fas fa-trash"></i> Excluir
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-info-circle"></i> Detalhes do Evento</h5>
      </div>
      <div class="card-body">
        <div class="row mb-3">
          <div class="col-sm-3">
            <strong>Título:</strong>
          </div>
          <div class="col-sm-9">
            <%= @event.title %>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-sm-3">
            <strong>Descrição:</strong>
          </div>
          <div class="col-sm-9">
            <% if @event.description.present? %>
              <%= simple_format(@event.description) %>
            <% else %>
              <em class="text-muted">Nenhuma descrição fornecida</em>
            <% end %>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-sm-3">
            <strong>Data de Início:</strong>
          </div>
          <div class="col-sm-9">
            <%= @event.formatted_start_date %>
            <% if @event.start_time %>
              às <%= @event.formatted_start_time %>
            <% end %>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-sm-3">
            <strong>Data de Término:</strong>
          </div>
          <div class="col-sm-9">
            <%= @event.formatted_end_date %>
            <% if @event.end_time %>
              às <%= @event.formatted_end_time %>
            <% end %>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-sm-3">
            <strong>Duração:</strong>
          </div>
          <div class="col-sm-9">
            <% if @event.start_date == @event.end_date %>
              Evento de um dia
            <% else %>
              <%= distance_of_time_in_words(@event.start_date, @event.end_date) %>
            <% end %>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-sm-3">
            <strong>Criado em:</strong>
          </div>
          <div class="col-sm-9">
            <%= @event.formatted_created_at %>
          </div>
        </div>

        <% if @event.updated_at != @event.created_at %>
        <div class="row mb-3">
          <div class="col-sm-3">
            <strong>Última atualização:</strong>
          </div>
          <div class="col-sm-9">
            <%= @event.formatted_updated_at %>
          </div>
        </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-calendar-check"></i> Status do Evento</h5>
      </div>
      <div class="card-body">
        <% today = Date.current %>
        <% if @event.end_date < today %>
          <div class="alert alert-info">
            <i class="fas fa-check-circle"></i>
            <strong>Evento Concluído</strong><br>
            <small>Este evento já foi realizado.</small>
          </div>
        <% elsif @event.start_date <= today && @event.end_date >= today %>
          <div class="alert alert-warning">
            <i class="fas fa-clock"></i>
            <strong>Evento em Andamento</strong><br>
            <small>Este evento está acontecendo agora.</small>
          </div>
        <% else %>
          <div class="alert alert-success">
            <i class="fas fa-calendar-alt"></i>
            <strong>Evento Planejado</strong><br>
            <small>
              Faltam <%= distance_of_time_in_words(Date.current, @event.start_date) %> para o evento.
            </small>
          </div>
        <% end %>

        <div class="d-grid gap-2">
          <%= link_to edit_direction_event_path(@event), class: "btn btn-warning" do %>
            <i class="fas fa-edit"></i> Editar Evento
          <% end %>
          
          <% if @event.start_date > Date.current %>
            <button type="button" class="btn btn-info" onclick="navigator.share({title: '<%= @event.title %>', text: '<%= @event.description %>'})">
              <i class="fas fa-share"></i> Compartilhar
            </button>
          <% end %>
        </div>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header">
        <h5><i class="fas fa-info"></i> Informações Adicionais</h5>
      </div>
      <div class="card-body">
        <small class="text-muted">
          <strong>Escola:</strong> <%= current_user.school.name %><br>
          <strong>Criado por:</strong> Direção<br>
          <strong>ID do evento:</strong> #<%= @event.id %>
        </small>
      </div>
    </div>
  </div>
</div>