<% content_for :title, "Relatórios" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1><i class="fas fa-chart-bar"></i> Relatórios Gerais</h1>
  <%= link_to direction_reports_path(format: :pdf), class: "btn btn-primary", target: "_blank" do %>
    <i class="fas fa-file-pdf"></i> Gerar PDF
  <% end %>
</div>

<div class="row">
  <!-- Relatório de Alunos -->
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-user-graduate"></i> Relatório de Alunos</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-6">
            <h3 class="text-primary"><%= @students_report[:total] %></h3>
            <small class="text-muted">Total de Alunos</small>
          </div>
          <div class="col-6">
            <h3 class="text-success"><%= @students_report[:active] %></h3>
            <small class="text-muted">Alunos Ativos</small>
          </div>
        </div>
        
        <hr>
        
        <h6>Alunos por Turma:</h6>
        <% @students_report[:by_classroom].each do |classroom, count| %>
          <div class="d-flex justify-content-between">
            <span><%= classroom %></span>
            <span class="badge bg-primary"><%= count %></span>
          </div>
        <% end %>
        
        <div class="mt-3">
          <h6>Matrículas Pendentes:</h6>
          <span class="badge bg-warning"><%= @students_report[:pending] %></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Relatório de Professores -->
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-chalkboard-teacher"></i> Relatório de Professores</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-6">
            <h3 class="text-info"><%= @teachers_report[:total] %></h3>
            <small class="text-muted">Total de Professores</small>
          </div>
          <div class="col-6">
            <h3 class="text-success"><%= @teachers_report[:active] %></h3>
            <small class="text-muted">Professores Ativos</small>
          </div>
        </div>
        
        <hr>
        
        <h6>Disciplinas por Professor:</h6>
        <% @teachers_report[:subjects_assigned].each do |teacher_name, count| %>
          <div class="d-flex justify-content-between small">
            <span><%= teacher_name %></span>
            <span class="badge bg-info"><%= count %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Relatório Acadêmico -->
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-graduation-cap"></i> Relatório Acadêmico</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-6 mb-3">
            <h3 class="text-success"><%= @academic_report[:attendance_rate] %>%</h3>
            <small class="text-muted">Taxa de Frequência</small>
          </div>
          <div class="col-6 mb-3">
            <h3 class="text-primary"><%= @academic_report[:average_grades] %></h3>
            <small class="text-muted">Média Geral</small>
          </div>
          <div class="col-6">
            <h3 class="text-info"><%= @academic_report[:total_activities] %></h3>
            <small class="text-muted">Total de Atividades</small>
          </div>
          <div class="col-6">
            <h3 class="text-warning"><%= @academic_report[:completed_activities] %></h3>
            <small class="text-muted">Atividades Concluídas</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Relatório de Ocorrências -->
  <div class="col-lg-6 mb-4">
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-exclamation-triangle"></i> Relatório de Ocorrências</h5>
      </div>
      <div class="card-body">
        <div class="text-center mb-3">
          <h3 class="text-danger"><%= @occurrences_report[:total_this_month] %></h3>
          <small class="text-muted">Ocorrências neste Mês</small>
        </div>
        
        <hr>
        
        <h6>Por Tipo:</h6>
        <% @occurrences_report[:by_type].each do |type, count| %>
          <div class="d-flex justify-content-between">
            <span><%= type.humanize %></span>
            <span class="badge bg-warning"><%= count %></span>
          </div>
        <% end %>
        
        <hr>
        
        <h6>Ocorrências Recentes:</h6>
        <% @occurrences_report[:recent].each do |occurrence| %>
          <div class="small mb-2">
            <strong><%= occurrence.student.full_name %></strong><br>
            <span class="text-muted">
              <%= occurrence.occurrence_type.humanize %> - 
              <%= occurrence.date.strftime("%d/%m/%Y") %>
            </span>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- Ações -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5><i class="fas fa-tools"></i> Ações Disponíveis</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-3 mb-2">
            <%= link_to direction_students_path, class: "btn btn-outline-primary w-100" do %>
              <i class="fas fa-user-graduate"></i><br>
              <small>Gerenciar Alunos</small>
            <% end %>
          </div>
          <div class="col-md-3 mb-2">
            <%= link_to direction_teachers_path, class: "btn btn-outline-success w-100" do %>
              <i class="fas fa-chalkboard-teacher"></i><br>
              <small>Gerenciar Professores</small>
            <% end %>
          </div>
          <div class="col-md-3 mb-2">
            <%= link_to direction_classrooms_path, class: "btn btn-outline-info w-100" do %>
              <i class="fas fa-users"></i><br>
              <small>Gerenciar Turmas</small>
            <% end %>
          </div>
          <div class="col-md-3 mb-2">
            <%= link_to direction_occurrences_path, class: "btn btn-outline-warning w-100" do %>
              <i class="fas fa-exclamation-triangle"></i><br>
              <small>Ver Ocorrências</small>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
