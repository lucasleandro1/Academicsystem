<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Relat√≥rio Geral - <%= @school.name %></title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 12px;
      line-height: 1.4;
      margin: 0;
      padding: 20px;
    }
    .header {
      text-align: center;
      border-bottom: 2px solid #333;
      padding-bottom: 20px;
      margin-bottom: 30px;
    }
    .school-name {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .report-title {
      font-size: 16px;
      color: #666;
      margin-bottom: 10px;
    }
    .report-date {
      font-size: 10px;
      color: #999;
    }
    .section {
      margin-bottom: 30px;
      page-break-inside: avoid;
    }
    .section-title {
      font-size: 14px;
      font-weight: bold;
      background-color: #f5f5f5;
      padding: 10px;
      border-left: 4px solid #007bff;
      margin-bottom: 15px;
    }
    .stats-grid {
      display: table;
      width: 100%;
      margin-bottom: 20px;
    }
    .stats-row {
      display: table-row;
    }
    .stats-cell {
      display: table-cell;
      padding: 8px;
      border: 1px solid #ddd;
      text-align: center;
      vertical-align: middle;
    }
    .stats-header {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    .number {
      font-size: 16px;
      font-weight: bold;
      color: #007bff;
    }
    .label {
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
    }
    .classroom-list {
      font-size: 11px;
      margin-top: 10px;
    }
    .classroom-item {
      margin-bottom: 5px;
      padding: 5px;
      background-color: #f9f9f9;
      border-left: 3px solid #28a745;
    }
    .footer {
      margin-top: 40px;
      text-align: center;
      font-size: 10px;
      color: #999;
      border-top: 1px solid #ddd;
      padding-top: 20px;
    }
    .page-break {
      page-break-before: always;
    }
  </style>
</head>
<body>
  <!-- Cabe√ßalho -->
  <div class="header">
    <div class="school-name"><%= @school.name %></div>
    <div class="report-title">Relat√≥rio Geral da Escola</div>
    <div class="report-date">
      Gerado em <%= Date.current.strftime("%d/%m/%Y √†s %H:%M") %>
    </div>
  </div>

  <!-- Resumo Executivo -->
  <div class="section">
    <div class="section-title">üìä Resumo Executivo</div>
    
    <div class="stats-grid">
      <div class="stats-row">
        <div class="stats-cell stats-header">Categoria</div>
        <div class="stats-cell stats-header">Total</div>
        <div class="stats-cell stats-header">Ativos</div>
        <div class="stats-cell stats-header">Status</div>
      </div>
      <div class="stats-row">
        <div class="stats-cell">
          <strong>üë®‚Äçüéì Alunos</strong>
        </div>
        <div class="stats-cell">
          <div class="number"><%= @students_report[:total] %></div>
          <div class="label">Total</div>
        </div>
        <div class="stats-cell">
          <div class="number"><%= @students_report[:active] %></div>
          <div class="label">Ativos</div>
        </div>
        <div class="stats-cell">
          <% if @students_report[:active] == @students_report[:total] %>
            ‚úÖ Todos ativos
          <% else %>
            ‚ö†Ô∏è <%= @students_report[:total] - @students_report[:active] %> inativos
          <% end %>
        </div>
      </div>
      <div class="stats-row">
        <div class="stats-cell">
          <strong>üë®‚Äçüè´ Professores</strong>
        </div>
        <div class="stats-cell">
          <div class="number"><%= @teachers_report[:total] %></div>
          <div class="label">Total</div>
        </div>
        <div class="stats-cell">
          <div class="number"><%= @teachers_report[:active] %></div>
          <div class="label">Ativos</div>
        </div>
        <div class="stats-cell">
          <% if @teachers_report[:active] == @teachers_report[:total] %>
            ‚úÖ Todos ativos
          <% else %>
            ‚ö†Ô∏è <%= @teachers_report[:total] - @teachers_report[:active] %> inativos
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Distribui√ß√£o por Turmas -->
  <div class="section">
    <div class="section-title">üè´ Distribui√ß√£o de Alunos por Turma</div>
    
    <div class="classroom-list">
      <% @students_report[:by_classroom].each do |classroom_name, student_count| %>
        <div class="classroom-item">
          <strong><%= classroom_name %></strong>: 
          <%= student_count %> aluno<%= student_count != 1 ? 's' : '' %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Desempenho Acad√™mico -->
  <div class="section">
    <div class="section-title">üìà Desempenho Acad√™mico</div>
    
    <div class="stats-grid">
      <div class="stats-row">
        <div class="stats-cell stats-header">M√©trica</div>
        <div class="stats-cell stats-header">Valor</div>
        <div class="stats-cell stats-header">Status</div>
      </div>
      <div class="stats-row">
        <div class="stats-cell">Taxa de Frequ√™ncia</div>
        <div class="stats-cell">
          <div class="number"><%= @academic_report[:attendance_rate] %>%</div>
        </div>
        <div class="stats-cell">
          <% if @academic_report[:attendance_rate] >= 85 %>
            ‚úÖ Excelente
          <% elsif @academic_report[:attendance_rate] >= 75 %>
            ‚ö†Ô∏è Aten√ß√£o
          <% else %>
            ‚ùå Cr√≠tico
          <% end %>
        </div>
      </div>
      <div class="stats-row">
        <div class="stats-cell">M√©dia Geral</div>
        <div class="stats-cell">
          <div class="number"><%= @academic_report[:average_grades] %></div>
        </div>
        <div class="stats-cell">
          <% if @academic_report[:average_grades] >= 7.0 %>
            ‚úÖ Boa
          <% elsif @academic_report[:average_grades] >= 5.0 %>
            ‚ö†Ô∏è Regular
          <% else %>
            ‚ùå Baixa
          <% end %>
        </div>
      </div>
      <div class="stats-row">
        <div class="stats-cell">Atividades Totais</div>
        <div class="stats-cell">
          <div class="number"><%= @academic_report[:total_activities] %></div>
        </div>
        <div class="stats-cell">
          <% completion_rate = @academic_report[:total_activities] > 0 ? (@academic_report[:completed_activities].to_f / @academic_report[:total_activities] * 100).round(1) : 0 %>
          <%= completion_rate %>% conclu√≠das
        </div>
      </div>
    </div>
  </div>

  <!-- Atribui√ß√£o de Professores -->
  <div class="section page-break">
    <div class="section-title">üë• Atribui√ß√£o de Professores</div>
    
    <div class="classroom-list">
      <% @teachers_report[:subjects_assigned].each do |teacher_name, subject_count| %>
        <div class="classroom-item">
          <strong><%= teacher_name %></strong>: 
          <%= subject_count %> disciplina<%= subject_count != 1 ? 's' : '' %> atribu√≠da<%= subject_count != 1 ? 's' : '' %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Recomenda√ß√µes -->
  <div class="section">
    <div class="section-title">üí° Recomenda√ß√µes</div>
    
    <div style="font-size: 11px; line-height: 1.5;">
      <% recommendations = [] %>
      
      <% if @academic_report[:attendance_rate] < 85 %>
        <% recommendations << "‚Ä¢ Implementar estrat√©gias para melhorar a taxa de frequ√™ncia dos alunos" %>
      <% end %>
      
      <% if @academic_report[:average_grades] < 6.0 %>
        <% recommendations << "‚Ä¢ Revisar metodologias de ensino para melhorar o desempenho acad√™mico" %>
      <% end %>
      
      <% if @students_report[:active] < @students_report[:total] %>
        <% recommendations << "‚Ä¢ Verificar situa√ß√£o dos alunos inativos e buscar estrat√©gias de reintegra√ß√£o" %>
      <% end %>
      
      <% if @teachers_report[:active] < @teachers_report[:total] %>
        <% recommendations << "‚Ä¢ Avaliar necessidade de contrata√ß√£o de novos professores" %>
      <% end %>
      
      <% if recommendations.empty? %>
        <% recommendations << "‚Ä¢ Continuar mantendo os bons indicadores da escola" %>
        <% recommendations << "‚Ä¢ Buscar sempre melhorias cont√≠nuas nos processos educacionais" %>
      <% end %>
      
      <% recommendations.each do |recommendation| %>
        <div style="margin-bottom: 8px;"><%= recommendation %></div>
      <% end %>
    </div>
  </div>

  <!-- Rodap√© -->
  <div class="footer">
    <div>
      <strong><%= @school.name %></strong><br>
      Relat√≥rio gerado automaticamente pelo Sistema Acad√™mico<br>
      Data: <%= Date.current.strftime("%d/%m/%Y") %> | 
      Ano Letivo: <%= Date.current.year %>
    </div>
  </div>
</body>
</html>