<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Meus Documentos</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <%= link_to new_students_document_path, class: "btn btn-primary" do %>
      <i class="fas fa-plus"></i> Adicionar Documento
    <% end %>
  </div>
</div>

<!-- Nav tabs -->
<ul class="nav nav-tabs" id="documentsTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="received-tab" data-bs-toggle="tab" data-bs-target="#received" type="button" role="tab" aria-controls="received" aria-selected="true">
      <i class="fas fa-inbox"></i> Documentos Recebidos (<%= @received_documents.count %>)
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="my-tab" data-bs-toggle="tab" data-bs-target="#my" type="button" role="tab" aria-controls="my" aria-selected="false">
      <i class="fas fa-file-upload"></i> Meus Documentos (<%= @my_documents.count %>)
    </button>
  </li>
</ul>

<!-- Tab panes -->
<div class="tab-content" id="documentsTabContent">
  <!-- Documentos Recebidos -->
  <div class="tab-pane fade show active" id="received" role="tabpanel" aria-labelledby="received-tab">
    <div class="mt-3">
      <% if @received_documents.any? %>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Nome do Documento</th>
                <th>Tipo</th>
                <th>Enviado por</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @received_documents.each do |document| %>
                <tr>
                  <td>
                    <i class="fas fa-file-<%= get_file_icon(document.file_type) %> me-2"></i>
                    <%= document.title %>
                  </td>
                  <td>
                    <span class="badge bg-secondary">
                      <%= document.type_description %>
                    </span>
                  </td>
                  <td>
                    <% if document.attached_by %>
                      <span class="badge bg-info">
                        <%= document.attached_by.name %> (<%= document.attached_by.user_type.humanize %>)
                      </span>
                    <% else %>
                      <span class="text-muted">Escola</span>
                    <% end %>
                  </td>
                  <td><%= document.created_at.strftime("%d/%m/%Y") %></td>
                  <td>
                    <div class="btn-group" role="group">
                      <%= link_to students_document_path(document), 
                                  class: "btn btn-sm btn-outline-info",
                                  title: "Visualizar detalhes" do %>
                        <i class="fas fa-eye"></i>
                      <% end %>
                      
                      <% if document.file_exists? %>
                        <%= link_to download_students_document_path(document), 
                                    class: "btn btn-sm btn-outline-primary",
                                    title: "Baixar documento",
                                    method: :get do %>
                          <i class="fas fa-download"></i>
                        <% end %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert alert-info mt-3">
          <i class="fas fa-info-circle"></i>
          Você ainda não recebeu documentos de professores ou da direção.
        </div>
      <% end %>
    </div>
  </div>

  <!-- Meus Documentos -->
  <div class="tab-pane fade" id="my" role="tabpanel" aria-labelledby="my-tab">
    <div class="mt-3">
      <% if @my_documents.any? %>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Nome do Documento</th>
                <th>Tipo</th>
                <th>Data de Upload</th>
                <th>Tamanho</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @my_documents.each do |document| %>
                <tr>
                  <td>
                    <i class="fas fa-file-<%= get_file_icon(document.file_type) %> me-2"></i>
                    <%= document.title %>
                  </td>
                  <td>
                    <span class="badge bg-primary">
                      <%= document.type_description %>
                    </span>
                  </td>
                  <td><%= document.created_at.strftime("%d/%m/%Y às %H:%M") %></td>
                  <td>
                    <% if document.file_size.present? %>
                      <%= number_to_human_size(document.file_size) %>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <div class="btn-group" role="group">
                      <%= link_to students_document_path(document), 
                                  class: "btn btn-sm btn-outline-info",
                                  title: "Visualizar detalhes" do %>
                        <i class="fas fa-eye"></i>
                      <% end %>
                      
                      <% if document.file_exists? %>
                        <%= link_to download_students_document_path(document), 
                                    class: "btn btn-sm btn-outline-primary",
                                    title: "Baixar documento",
                                    method: :get do %>
                          <i class="fas fa-download"></i>
                        <% end %>
                      <% end %>

                      <%= link_to students_document_path(document), 
                                  class: "btn btn-sm btn-outline-danger",
                                  title: "Excluir documento",
                                  method: :delete,
                                  data: { 
                                    confirm: "Tem certeza que deseja excluir este documento?",
                                    bs_toggle: "tooltip"
                                  } do %>
                        <i class="fas fa-trash"></i>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert alert-info mt-3">
          <i class="fas fa-info-circle"></i>
          Você ainda não adicionou nenhum documento. 
          <%= link_to "Clique aqui para adicionar seu primeiro documento", new_students_document_path, class: "alert-link" %>.
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5>Documentos por Tipo</h5>
      </div>
      <div class="card-body">
        <% if @documents_by_type.any? %>
          <% @documents_by_type.each do |type, count| %>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span><%= type.humanize %>:</span>
              <span class="badge bg-primary"><%= count %></span>
            </div>
          <% end %>
        <% else %>
          <p class="text-muted mb-0">Nenhum documento encontrado.</p>
        <% end %>
      </div>
    </div>
  </div>
  
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5>Informações</h5>
      </div>
      <div class="card-body">
        <p class="mb-2">
          <i class="fas fa-info-circle text-info"></i>
          Os documentos disponíveis aqui são fornecidos pela secretaria da escola.
        </p>
        <p class="mb-2">
          <i class="fas fa-download text-primary"></i>
          Clique em "Download" para baixar o arquivo.
        </p>
        <p class="mb-0">
          <i class="fas fa-question-circle text-warning"></i>
          Em caso de dúvidas, entre em contato com a secretaria.
        </p>
      </div>
    </div>
  </div>
</div>
