<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Meus Documentos</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <% if current_user.classroom&.class_schedules&.any? %>
      <%= link_to generate_report_card_students_documents_path, class: "btn btn-success me-2", 
                  title: "Gerar e baixar boletim escolar em PDF" do %>
        <i class="fas fa-file-pdf"></i> Gerar Boletim Escolar
      <% end %>
    <% else %>
      <button class="btn btn-outline-secondary me-2" disabled title="Boletim disponível após matrícula em turma com disciplinas">
        <i class="fas fa-file-pdf"></i> Gerar Boletim Escolar
      </button>
    <% end %>
    <%= link_to new_students_document_path, class: "btn btn-primary" do %>
      <i class="fas fa-plus"></i> Adicionar Documento
    <% end %>
  </div>
</div>

<% unless current_user.classroom&.class_schedules&.any? %>
  <div class="alert alert-info">
    <i class="fas fa-info-circle"></i>
    <strong>Informação:</strong> O boletim escolar será gerado automaticamente assim que você estiver matriculado em uma turma com disciplinas e notas cadastradas.
  </div>
<% end %>

<!-- Nav tabs -->
<ul class="nav nav-tabs" id="documentsTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="received-tab" data-bs-toggle="tab" data-bs-target="#received" type="button" role="tab" aria-controls="received" aria-selected="true">
      <i class="fas fa-inbox"></i> Documentos Recebidos (<%= @received_documents.count %>)
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="my-tab" data-bs-toggle="tab" data-bs-target="#my" type="button" role="tab" aria-controls="my" aria-selected="false">
      <i class="fas fa-file-upload"></i> Meus Documentos (<%= @my_documents.count %>)
    </button>
  </li>
</ul>

<!-- Tab panes -->
<div class="tab-content" id="documentsTabContent">
  <!-- Documentos Recebidos -->
  <div class="tab-pane fade show active" id="received" role="tabpanel" aria-labelledby="received-tab">
    <div class="mt-3">
      <% if @received_documents.any? %>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Nome do Documento</th>
                <th>Tipo</th>
                <th>Enviado por</th>
                <th>Data</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @received_documents.each do |document| %>
                <tr>
                  <td>
                    <i class="fas fa-file-<%= get_file_icon(document.file_type) %> me-2"></i>
                    <%= document.title %>
                  </td>
                  <td>
                    <span class="badge bg-secondary">
                      <%= document.type_description %>
                    </span>
                  </td>
                  <td>
                    <% if document.attached_by %>
                      <span class="badge bg-info">
                        <%= document.attached_by.full_name %> (<%= document.attached_by.user_type.humanize %>)
                      </span>
                    <% else %>
                      <span class="text-muted">Escola</span>
                    <% end %>
                  </td>
                  <td><%= document.created_at.strftime("%d/%m/%Y") %></td>
                  <td>
                    <div class="btn-group" role="group">
                      <%= link_to students_document_path(document), 
                                  class: "btn btn-sm btn-outline-info",
                                  title: "Visualizar detalhes" do %>
                        <i class="fas fa-eye"></i>
                      <% end %>
                      
                      <% if document.file_exists? %>
                        <%= link_to download_students_document_path(document), 
                                    class: "btn btn-sm btn-outline-primary",
                                    title: "Baixar documento",
                                    method: :get do %>
                          <i class="fas fa-download"></i>
                        <% end %>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert alert-info mt-3">
          <i class="fas fa-info-circle"></i>
          Você ainda não recebeu documentos de professores ou da direção.
        </div>
      <% end %>
    </div>
  </div>

  <!-- Meus Documentos -->
  <div class="tab-pane fade" id="my" role="tabpanel" aria-labelledby="my-tab">
    <div class="mt-3">
      <% if @my_documents.any? %>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Nome do Documento</th>
                <th>Tipo</th>
                <th>Data de Upload</th>
                <th>Tamanho</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @my_documents.each do |document| %>
                <tr>
                  <td>
                    <i class="fas fa-file-<%= get_file_icon(document.file_type) %> me-2"></i>
                    <%= document.title %>
                  </td>
                  <td>
                    <span class="badge bg-primary">
                      <%= document.type_description %>
                    </span>
                  </td>
                  <td><%= document.created_at.strftime("%d/%m/%Y às %H:%M") %></td>
                  <td>
                    <% if document.file_size.present? %>
                      <%= number_to_human_size(document.file_size) %>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <div class="btn-group" role="group">
                      <%= link_to students_document_path(document), 
                                  class: "btn btn-sm btn-outline-info",
                                  title: "Visualizar detalhes" do %>
                        <i class="fas fa-eye"></i>
                      <% end %>
                      
                      <% if document.file_exists? %>
                        <%= link_to download_students_document_path(document), 
                                    class: "btn btn-sm btn-outline-primary",
                                    title: "Baixar documento",
                                    method: :get do %>
                          <i class="fas fa-download"></i>
                        <% end %>
                      <% end %>

                      <%= link_to students_document_path(document), 
                                  class: "btn btn-sm btn-outline-danger",
                                  title: "Excluir documento",
                                  method: :delete,
                                  data: { 
                                    confirm: "Tem certeza que deseja excluir este documento?",
                                    bs_toggle: "tooltip"
                                  } do %>
                        <i class="fas fa-trash"></i>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert alert-info mt-3">
          <i class="fas fa-info-circle"></i>
          Você ainda não adicionou nenhum documento. 
          <%= link_to "Clique aqui para adicionar seu primeiro documento", new_students_document_path, class: "alert-link" %>.
        </div>
      <% end %>
    </div>
  </div>
</div>

