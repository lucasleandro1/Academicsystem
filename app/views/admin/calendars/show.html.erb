<% content_for :title, @calendar.title %>

<div                                    when 'holiday' then 'danger'
                                    when 'vacation' then 'success'
                                    when 'exam_period' then 'warning'
                                    when 'meeting' then 'primary'
                                    else 'secondary'
                                    end %>">"d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <div>
    <h1 class="h2">
      <i class="fas fa-calendar-day text-primary me-2"></i>
      <%= @calendar.title %>
    </h1>
    <p class="text-muted mb-0"><%= @calendar.formatted_date %> - <%= @calendar.type_description %></p>
  </div>
  <div class="btn-toolbar mb-2 mb-md-0">
    <%= link_to edit_admin_calendar_path(@calendar), class: "btn btn-warning me-2" do %>
      <i class="fas fa-edit"></i> Editar
    <% end %>
    <%= link_to admin_calendars_path, class: "btn btn-outline-secondary" do %>
      <i class="fas fa-arrow-left"></i> Voltar
    <% end %>
  </div>
</div>

<div class="row">
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">
          <i class="fas fa-info-circle me-2"></i>
          Detalhes do Evento
        </h6>
      </div>
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-3">Título:</dt>
          <dd class="col-sm-9"><%= @calendar.title %></dd>

          <dt class="col-sm-3">Data:</dt>
          <dd class="col-sm-9">
            <%= @calendar.formatted_date %>
            <% if @calendar.upcoming? %>
              <span class="badge bg-success ms-2">Próximo</span>
            <% else %>
              <span class="badge bg-secondary ms-2">Passado</span>
            <% end %>
          </dd>

          <dt class="col-sm-3">Tipo:</dt>
          <dd class="col-sm-9">
            <span class="badge bg-<%= case @calendar.calendar_type
                                    when 'holiday' then 'danger'
                                    when 'vacation' then 'success'
                                    when 'exam_period' then 'warning'
                                    when 'enrollment' then 'info'
                                    when 'meeting' then 'primary'
                                    else 'secondary'
                                    end %> me-2">
              <%= @calendar.type_description %>
            </span>
          </dd>

          <dt class="col-sm-3">Abrangência:</dt>
          <dd class="col-sm-9">
            <% if @calendar.municipal? %>
              <span class="badge bg-primary">
                <i class="fas fa-building"></i> Municipal (todas as escolas)
              </span>
            <% elsif @calendar.school %>
              <span class="badge bg-info">
                <i class="fas fa-school"></i> <%= @calendar.school.name %>
              </span>
            <% end %>
          </dd>

          <% if @calendar.description.present? %>
            <dt class="col-sm-3">Descrição:</dt>
            <dd class="col-sm-9">
              <div class="border rounded p-3 bg-light">
                <%= simple_format(@calendar.description) %>
              </div>
            </dd>
          <% end %>

          <dt class="col-sm-3">Criado em:</dt>
          <dd class="col-sm-9">
            <%= @calendar.created_at.strftime("%d/%m/%Y às %H:%M") %>
          </dd>

          <% if @calendar.updated_at != @calendar.created_at %>
            <dt class="col-sm-3">Atualizado em:</dt>
            <dd class="col-sm-9">
              <%= @calendar.updated_at.strftime("%d/%m/%Y às %H:%M") %>
            </dd>
          <% end %>
        </dl>
      </div>
    </div>

    <!-- Ações -->
    <div class="card mt-4">
      <div class="card-header">
        <h6 class="mb-0">
          <i class="fas fa-cog me-2"></i>
          Ações
        </h6>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2 d-md-flex">
          <%= link_to edit_admin_calendar_path(@calendar), 
                     class: "btn btn-warning me-md-2" do %>
            <i class="fas fa-edit"></i> Editar Evento
          <% end %>
          <%= link_to admin_calendar_path(@calendar), 
                     method: :delete,
                     confirm: "Tem certeza que deseja remover este evento do calendário?#{ @calendar.municipal? ? ' Este evento será removido de todas as escolas.' : '' }",
                     class: "btn btn-outline-danger" do %>
            <i class="fas fa-trash"></i> Remover Evento
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <!-- Informações Adicionais -->
    <div class="card">
      <div class="card-header">
        <h6 class="mb-0">
          <i class="fas fa-calendar-alt text-info me-2"></i>
          Contexto do Calendário
        </h6>
      </div>
      <div class="card-body">
        <% if @calendar.municipal? %>
          <div class="alert alert-info">
            <h6><i class="fas fa-building"></i> Evento Municipal</h6>
            <p class="small mb-0">Este evento aparece no calendário de todas as <%= School.count %> escolas da rede municipal.</p>
          </div>
        <% end %>

        <h6 class="mt-3">Navegação Rápida:</h6>
        <div class="d-grid gap-2">
          <%= link_to admin_calendars_path, class: "btn btn-outline-primary btn-sm" do %>
            <i class="fas fa-list"></i> Todos os Eventos
          <% end %>
          <%= link_to municipal_admin_calendars_path, class: "btn btn-outline-info btn-sm" do %>
            <i class="fas fa-building"></i> Eventos Municipais
          <% end %>
          <%= link_to new_admin_calendar_path, class: "btn btn-outline-success btn-sm" do %>
            <i class="fas fa-plus"></i> Novo Evento
          <% end %>
        </div>

        <div class="mt-3">
          <h6>Estatísticas:</h6>
          <p class="small text-muted mb-1">
            <i class="fas fa-calendar"></i> <%= Calendar.count %> eventos no total
          </p>
          <p class="small text-muted mb-1">
            <i class="fas fa-arrow-up"></i> <%= Calendar.upcoming.count %> próximos eventos
          </p>
          <p class="small text-muted mb-0">
            <i class="fas fa-building"></i> <%= Calendar.municipal.count %> eventos municipais
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
